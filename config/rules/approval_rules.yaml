# Rule YAML reference (for rule authors): config/rules/RULES_YAML_REFERENCE.md
# action:
#   type: comment_only
#   assign_to: "someone@hyvesolutions.com"
#   reassign_to: "another@hyvesolutions.com"
#   transition_to: "In Progress"
#   comment_template: |
#     Approved. Proceed.
#     [RB]



- id: approval_request_ack
  name: "Approval request acknowledgement"
  description: >
    When the latest Jira comment includes 'Requesting'
    and the commenter is on the approved list, post an acknowledgement comment.
  allow_high_slt_attempts: true
  allow_on_same_failure: true

  # Make this higher than normal triage rules so it wins when present.
  priority: 100

  scope:
    # Requires the new ErrorEvent field populated from Jira comments.
    jira_latest_comment_text:
      contains: "Requesting approval"

    # Match the latest comment author identifier.
    # Jira Server/DC usually provides author.name; Cloud provides accountId.
    # Put the exact identifiers you see in issue JSON here.
    jira_latest_comment_author:
      - "byron.delaney@hyvesolutions.com"
      - "shaun.millerii@hyvesolutions.com"
      - "david.nguyen2@hyvesolutions.com"
      - "ethan.aboumrad@hyvesolutions.com"
      - "elias.bakhtani@hyvesolutions.com"



    jira_comments_text:
      not_contains: "Approved. Proceed."

  # Patterns are still evaluated against summary+description (combined_text),
  # so use an always-true pattern and rely on scope gating.
  patterns:
    - type: regex
      value: ".*"

  action:
    
    reassign_to: "{jira_latest_comment_author}"
    type: "comment_only"
    comment_template: |
      Approved. Proceed.

