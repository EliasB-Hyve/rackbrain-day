# RackBrain config reference

This document describes `config/config.yaml` settings used by RackBrain.

## Polling

RackBrain fetches candidate tickets from Jira using JQL, then evaluates rules against each fetched ticket.

Run polling via CLI:

- `python3 -m rackbrain poll` (Linux/macOS)
- `py -m rackbrain poll` (Windows)

### `polling.jql`

`polling.jql` is the primary JQL used for normal rule processing.

Tip: Use YAML block scalars (`|`) for multi-line JQL to avoid quoting/escaping issues.

### `polling.extra_queries`

Use `polling.extra_queries` to run additional JQL queries in the same poll cycle, but restrict each query to a subset of rules.

This is useful when you need a wider or different "ticket fetch window" for a specific workflow rule (example: approval acknowledgements on older tickets) without changing which tickets are evaluated by the rest of the ruleset.

Each entry supports:

- `name` (optional): label shown in poll output.
- `enabled` (optional, default `true`): set `false` to disable the query.
- `jql` (required): the JQL for this extra query.
- `only_rule_ids` (required): list of rule `id`s that are eligible to run for this query.
- `max_results` (optional): overrides `polling.max_results` for this query.

Notes:
- The primary query still runs first (full ruleset).
- Extra queries run after, and RackBrain skips tickets already queued/processed earlier in the same cycle.

#### Example: approval ack for older tickets

This example runs only the `approval_request_ack` rule against tickets updated in the last hour, without requiring a recent `created` time:

```yaml
polling:
  extra_queries:
    - name: approval_ack_old_tickets
      only_rule_ids: ["approval_request_ack"]
      max_results: 200
      jql: |
        project IN (MFGS)
        AND Location = Fremont
        AND updated >= -1h
        AND status = "In Progress"
        AND assignee = currentUser()
        ORDER BY updated DESC
```

## Processing

### `processing.required_combined_text_contains`

Optional safety gate: if set, RackBrain will **skip rule evaluation** unless the Jira ticket's `summary + description` contains this literal substring (case-insensitive).

This is useful to ensure RackBrain only processes tickets with a known bot/template marker like:

```yaml
processing:
  required_combined_text_contains: "This ticket generated by EVE BOT"
```
